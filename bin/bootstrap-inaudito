#!/usr/bin/env bash
#
# bootstrap-inaudito - Clone Inaudito work repositories
#
# Initializes gopass password store and clones all Inaudito repositories:
#   - passwords repo (GitLab)
#   - architecture repo
#   - All application repos into architecture/apps/
#
# Dependencies: git, gopass
# Side effects:
#   - Clones multiple repositories into ~/git/
#   - Initializes gopass password store
#   - Requires SSH access to gitlab.com:inaudito-ops and gitlab.com:inaudito

set -e
set -o pipefail

if [ ! -d "$HOME/git/passwords" ]; then
  git clone git@gitlab.com:inaudito-ops/passwords.git "$HOME/git/passwords"
  yes 0 | gopass init
  gopass show inaudito/architecture-init-test
fi

if [ ! -d "$HOME/git/architecture" ]; then
  git clone git@gitlab.com:inaudito/architecture.git "$HOME/git/architecture"
fi

APPS=(
  ci
  cli
  configurator
  core
  dumpster
  infrastructure
  jobads
  jobcrawler
  jobcrawler-browser
  jobmixer-legacy
  notes
  odoo
  partner-docs
  util
)

for APP in "${APPS[@]}"; do
  DIR="$HOME/git/architecture/apps/$APP"

  if [ ! -d "$DIR" ]; then
    git clone "git@gitlab.com:inaudito/${APP}.git" "$DIR"
  fi
done
